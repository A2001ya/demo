pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                // Clone du code source depuis votre référentiel Git
                git 'https://github.com/A2001ya/demo.git'

                // Construction de l'image Docker
                script {
                    dockerImage = docker.build('ayabouchantouf/dockerimage', .)
                }
            }
        }

        stage('Publish') {
            steps {
                // Connexion à DockerHub
                withDockerRegistry([ url: 'https://hub.docker.com/repositories/ayabouchantouf']) {
                    // Pousse de l'image vers DockerHub
                    script {
                        docker.withRegistry('', 'dockerhub-credentials') {
                            dockerImage.push()
                        }
                    }
                }
            }
        }

        stage('Deploy') {
            steps {
                // Exécution de l'image Docker
                script {
                    docker.image('votre-utilisateur/nom-image:latest').run("-p 8080:8080")
                }
            }
        }
    }
}
